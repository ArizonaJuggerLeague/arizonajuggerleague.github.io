<!doctype html><html class="no-js" lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Read TAR-file in 26 lines of Ansi-C code</title><link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/styles_feeling_responsive_light.css"><link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/styles_feeling_responsive.css"> <script src="http://localhost:4000/assets/js/modernizr.min.js"></script> <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script> <script> WebFont.load({ google: { families: [ 'Lato:400,700,400italic:latin', 'Volkhov::latin' ] } }); </script> <noscript><link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7CVolkhov' rel='stylesheet' type='text/css'> </noscript><meta name="description" content="Archivers - it&#39;s scary! Huge and terrible algorithms that an ordinary person will never understand! Rar, zip, gzip, tar are modern de facto standards, which means extremely complex and tricky things that you should not try to understand. Well, tar looks simpler, maybe it&#39;s not that hard? See git with the sources. We see dozens of files, many of tens kilobytes. Hmm. Apparently, a dead end."><link rel="canonical" href="http://localhost:4000/articles/read-tar-in-26-lines/"><meta property="og:title" content="Read TAR-file in 26 lines of Ansi-C code"><meta property="og:description" content="Archivers - it&#39;s scary! Huge and terrible algorithms that an ordinary person will never understand! Rar, zip, gzip, tar are modern de facto standards, which means extremely complex and tricky things that you should not try to understand. Well, tar looks simpler, maybe it&#39;s not that hard? See git with the sources. We see dozens of files, many of tens kilobytes. Hmm. Apparently, a dead end."><meta property="og:url" content="http://localhost:4000/articles/read-tar-in-26-lines/"><meta property="og:locale" content="en_EN"><meta property="og:type" content="website"><meta property="og:site_name" content="Arizona Jugger League"><meta property="article:author" content="https://www.facebook.com/Arizona Jugger League"><link type="text/plain" rel="author" href="http://localhost:4000/humans.txt"><link rel="icon" sizes="32x32" href="http://localhost:4000/assets/img/favicon-32x32.png"><link rel="icon" sizes="192x192" href="http://localhost:4000/assets/img/touch-icon-192x192.png"><link rel="apple-touch-icon-precomposed" sizes="180x180" href="http://localhost:4000/assets/img/apple-touch-icon-180x180-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://localhost:4000/assets/img/apple-touch-icon-152x152-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/assets/img/apple-touch-icon-144x144-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://localhost:4000/assets/img/apple-touch-icon-120x120-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/assets/img/apple-touch-icon-114x114-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="76x76" href="http://localhost:4000/assets/img/apple-touch-icon-76x76-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/assets/img/apple-touch-icon-72x72-precomposed.png"><link rel="apple-touch-icon-precomposed" href="http://localhost:4000/assets/img/apple-touch-icon-precomposed.png"><meta name="msapplication-TileImage" content="http://localhost:4000/assets/img/msapplication_tileimage.png"><meta name="msapplication-TileColor" content="#fabb00"><body id="top-of-page" class="post"><div id="navigation" class="sticky"><nav class="top-bar" role="navigation" data-topbar><ul class="title-area"><li class="name"><h1 class="show-for-small-only"><a href="http://localhost:4000" class="icon-tree"> Arizona Jugger League</a></h1><li class="toggle-topbar menu-icon"><a href="#"><span>Navigation</span></a></ul><section class="top-bar-section"><ul class="right"><li class="divider"><li><a href="http://localhost:4000/search/">Search</a><li class="divider"><li><a href="http://localhost:4000/about/">About</a></ul><ul class="left"><li><a href="http://localhost:4000/">DeXP</a><li class="divider"><li><a href="http://localhost:4000/games/">Games</a><li class="divider"><li><a href="http://localhost:4000/tools/">Tools</a><li class="divider"><li><a href="http://localhost:4000/sites/">Sites</a><li class="divider"><li><a href="http://localhost:4000/articles/">Articles</a><li class="divider"><li><a href="http://localhost:4000/photo/">Photo</a><li class="divider"><li><a href="http://localhost:4000/russian/">Russian</a><li class="divider"><li class="has-dropdown"> <a href="http://localhost:4000/blog/">Blog</a><ul class="dropdown"><li><a href="http://localhost:4000/blog/archive/">Blog Archive</a></ul><li class="divider"></ul></section></nav></div><div id="masthead"><div class="row"><div class="small-12 columns"> <a id="logo" href="http://localhost:4000/" title="Arizona Jugger League – Arizona Jugger League"> <img src="http://localhost:4000/assets/img/logo.png" alt="Arizona Jugger League – Arizona Jugger League"> </a></div></div></div><div class="row t30"><div class="medium-8 columns medium-offset-2 end"><article itemscope itemtype="http://schema.org/Article"><header><div itemprop="name"><p class="subheadline">Low level programming<h1>Read TAR-file in 26 lines of Ansi-C code</h1></div></header><p class="teaser" itemprop="description"> Archivers - it's scary! Huge and terrible algorithms that an ordinary person will never understand! Rar, zip, gzip, tar are modern de facto standards, which means extremely complex and tricky things that you should not try to understand. Well, tar looks simpler, maybe it's not that hard? See <a href='http://git.savannah.gnu.org/cgit/tar.git/tree/src'>git</a> with the sources. We see dozens of files, many of tens kilobytes. Hmm. Apparently, a dead end.<div itemprop="articleSection"><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>__________________|      |____________________________________________
     ,--.    ,--.          ,--.   ,--.
    |oo  | _  \  `.       | oo | |  oo|
o  o|~~  |(_) /   ;       | ~~ | |  ~~|o  o  o  o  o  o  o  o  o  o  o
    |/\/\|   '._,'        |/\/\| |/\/\|
__________________        ____________________________________________
                  |      |dwb
</code></pre></div></div><p>In fact, everything is not so difficult. The documentation described that tar is just a way to write multiple files to tape. So everything should be simple. In fact - a set of auxiliary information for each file, then its contents directly. Only understanding of this fact allowed me to write the reader of tar-files in 26 lines.<p>Why should tar be used instead of zip? The question of using tar rose for me when I wanted to get the archiver “for free” in my tiny C-applications. With a minimal growth of the executable and without unnecessary dependencies. For example, the <a href="/tools/dxpmdxconverter/">dxPmdxConverter</a> utility can read BMP and convert it to PNG using <a href="http://lodev.org/lodepng/">LodePNG</a>. So the application already has a function that “archives” an array of pixels into a compressed PNG format. PNG is compressed by the <a href="https://en.wikipedia.org/wiki/DEFLATE">Deflate</a> algorithm, which is used in zip and gzip. Moreover, it is used directly in gzip - the gzip header is written, then the data stream from Deflate, then the crc-sum. The output is a ready .gz file which can be opened by any archiver. However, gzip can compress only one file. So you need to combine several files into one before compression. The most common way to do this is tar.<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ____  _   _  ____      __  ____        __ _       _            __   ____ ______       
|  _ \| \ | |/ ___|    / / |  _ \  ___ / _| | __ _| |_ ___     / /  / ___|__  (_)_ __  
| |_) |  \| | |  _    / /  | | | |/ _ \ |_| |/ _` | __/ _ \   / /  | |  _  / /| | '_ \ 
|  __/| |\  | |_| |  / /   | |_| |  __/  _| | (_| | ||  __/  / /   | |_| |/ /_| | |_) |
|_|   |_| \_|\____| /_/    |____/ \___|_| |_|\__,_|\__\___| /_/     \____/____|_| .__/ 
                                                                                |_|
</code></pre></div></div><p>Next time I needed tar in a similar situation. I wanted not only store the resources for <a href="http://localhost:4000/games/wordlase/">Wordlase</a> game, but to archive and compress them. I can pack resources for a really long time on my machine. But the resources will be unpacked every time when a user starts the game. So the solution should work quickly. Public domain implementation of the compression algorithm was found on the Internet, but it can pack only one file. That’s how the hero of this publication was born - <a href="/tools/dxtarread/">dxTarRead</a>.<p>Advantages of dxTarRead:<ol><li>Does not require additional memory, uses only what is passed in<li>Easy to use, only 1 function<li>No dependencies (even stdlibc not used), embedded friendly<li>C89, i.e. theoretically can be correctly compiled even on a microwave using Visual Studio<li>Public Domain</ol><p>The main disadvantage is that the tar file must be entirely read into memory before usage. On the other hand, resources will still be used, i.e. will be loaded. Then why not load them from the disk at once, and take the data from tar directly when you need it.<p>So, tar. The basic information on the standard can be found on <a href="https://www.gnu.org/software/tar/manual/html_node/Standard.html">GNU.org</a>. I used only the description of the structure “struct posix_header”. These constants are taken from it:<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">int</span> <span class="n">NAME_OFFSET</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SIZE_OFFSET</span> <span class="o">=</span> <span class="mi">124</span><span class="p">,</span> <span class="n">MAGIC_OFFSET</span> <span class="o">=</span> <span class="mi">257</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">BLOCK_SIZE</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span> <span class="n">NAME_SIZE</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">SZ_SIZE</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">MAGIC_SIZE</span> <span class="o">=</span><span class="mi">5</span><span class="p">;</span>
</code></pre></div></div><p>These constants can be read like this: if you move from the beginning of the tar block to 124 bytes (SIZE_OFFSET), then in the next 12 bytes (SZ_SIZE) will store the file size inside the tar.<p>Do not forget to read the documentation! There we can find out that the size is stored in the octal system ;-) If you read the bytes from the end of SZ_SIZE and add a digit multiplied by 8, you get the size in the usual decimal form.<p>In C language it’s looks like:<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">tar</span> <span class="o">+</span> <span class="n">SIZE_OFFSET</span> <span class="o">+</span> <span class="n">currentBlockStart</span><span class="p">;</span>
<span class="kt">long</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">SZ_SIZE</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">mul</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span> <span class="n">mul</span><span class="o">*=</span><span class="mi">8</span><span class="p">,</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="cm">/* Octal str to int */</span>
    <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">sz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="sc">'1'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">sz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="sc">'9'</span><span class="p">)</span> <span class="p">)</span> <span class="n">size</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'0'</span><span class="p">)</span> <span class="o">*</span> <span class="n">mul</span><span class="p">;</span>
</code></pre></div></div><p>Now we are very close to the topic of tar-blocks. It’s just 512 bytes of data - either the tar header or bytes of the file written consecutively. The 512 bytes are still reserved if the last block of the file takes less than 512 bytes. Each tarball looks like this:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+-------+-------+-------+-------+-------+-------+
| tar 1 | file1 |  ...  | file1 | tar 2 | file2 | ...
+-------+-------+-------+-------+-------+-------+
</code></pre></div></div><p>There is a block with the tar header which specifies the size of the stored file. Next, come <em>N</em> blocks with the contents of the file. So you need to move to (N + 1) * 512 bytes to move to the next file in tar. Code:<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">newOffset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">size</span><span class="o">/</span><span class="n">BLOCK_SIZE</span><span class="p">)</span> <span class="o">*</span> <span class="n">BLOCK_SIZE</span><span class="p">;</span> <span class="cm">/* trim by block size */</span>
<span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">size</span> <span class="o">%</span> <span class="n">BLOCK_SIZE</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="n">newOffset</span> <span class="o">+=</span> <span class="n">BLOCK_SIZE</span><span class="p">;</span>
</code></pre></div></div><p>The algorithm:<ol><li>Read file name and its size from the block.<li>Return the link to the user if the file name matches.<li>Otherwise, jump to the next block and repeat from step 1.</ol><p>I had to implement strncmp analog on the loop to compare the file name:<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">while</span><span class="p">((</span><span class="n">i</span><span class="o">&lt;</span><span class="n">NAME_SIZE</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">fileName</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">fileName</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="n">i</span><span class="o">++</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">fileName</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span> <span class="n">found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div></div><p>That’s all. All source code is considered. Full function code:<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">dxTarRead</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span><span class="o">*</span> <span class="n">tarData</span><span class="p">,</span> <span class="k">const</span> <span class="kt">long</span> <span class="n">tarSize</span><span class="p">,</span> 
                      <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fileName</span><span class="p">,</span> <span class="kt">long</span><span class="o">*</span> <span class="n">fileSize</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">const</span> <span class="kt">int</span> <span class="n">NAME_OFFSET</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">SIZE_OFFSET</span><span class="o">=</span><span class="mi">124</span><span class="p">,</span> <span class="n">MAGIC_OFFSET</span><span class="o">=</span><span class="mi">257</span><span class="p">;</span>
   <span class="k">const</span> <span class="kt">int</span> <span class="n">BLOCK_SIZE</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">NAME_SIZE</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">SZ_SIZE</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">MAGIC_SIZE</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span>
   <span class="k">const</span> <span class="kt">char</span> <span class="n">MAGIC</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"ustar"</span><span class="p">;</span> <span class="cm">/* Modern GNU tar's magic const */</span>
   <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">tar</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="n">tarData</span><span class="p">;</span> <span class="cm">/*From "void*" to "char*" */</span>
   <span class="kt">long</span> <span class="n">size</span><span class="p">,</span> <span class="n">mul</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">newOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="o">*</span><span class="n">fileSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/*will be zero if TAR wrong or there is no such file*/</span>
   <span class="k">do</span> <span class="p">{</span> <span class="cm">/* "Load" data from tar - just point to passed memory */</span>
       <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">name</span> <span class="o">=</span> <span class="n">tar</span> <span class="o">+</span> <span class="n">NAME_OFFSET</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="n">newOffset</span><span class="p">;</span>
       <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">tar</span> <span class="o">+</span> <span class="n">SIZE_OFFSET</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="n">newOffset</span><span class="p">;</span> <span class="cm">/* size str */</span>
       <span class="n">p</span> <span class="o">+=</span> <span class="n">newOffset</span><span class="p">;</span> <span class="cm">/* pointer to current file's data in TAR */</span>

       <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">MAGIC_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="cm">/* Check for supported TAR version */</span>
           <span class="k">if</span><span class="p">(</span> <span class="n">tar</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">MAGIC_OFFSET</span> <span class="o">+</span> <span class="n">p</span><span class="p">]</span> <span class="o">!=</span> <span class="n">MAGIC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

       <span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* Convert file size from string into integer */</span>
       <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">SZ_SIZE</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">mul</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span> <span class="n">mul</span><span class="o">*=</span><span class="mi">8</span><span class="p">,</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="cm">/* Octal str to int */</span>
           <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">sz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;=</span><span class="sc">'1'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">sz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="sc">'9'</span><span class="p">)</span> <span class="p">)</span> <span class="n">size</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="sc">'0'</span><span class="p">)</span><span class="o">*</span><span class="n">mul</span><span class="p">;</span>

       <span class="cm">/*Offset size in bytes. Depends on file size and TAR block size */</span>
       <span class="n">newOffset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">size</span><span class="o">/</span><span class="n">BLOCK_SIZE</span><span class="p">)</span> <span class="o">*</span> <span class="n">BLOCK_SIZE</span><span class="p">;</span> <span class="cm">/*trim by block */</span>
       <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">size</span> <span class="o">%</span> <span class="n">BLOCK_SIZE</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="n">newOffset</span> <span class="o">+=</span> <span class="n">BLOCK_SIZE</span><span class="p">;</span>

       <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* strncmp - compare file's name with that a user wants */</span>
       <span class="k">while</span><span class="p">((</span><span class="n">i</span><span class="o">&lt;</span><span class="n">NAME_SIZE</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">fileName</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">fileName</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="n">i</span><span class="o">++</span><span class="p">;</span>
       <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">fileName</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span> <span class="n">found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
   <span class="p">}</span> <span class="k">while</span><span class="p">(</span> <span class="o">!</span><span class="n">found</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">newOffset</span> <span class="o">+</span> <span class="n">BLOCK_SIZE</span> <span class="o">&lt;=</span> <span class="n">tarSize</span><span class="p">)</span> <span class="p">);</span>
   <span class="k">if</span><span class="p">(</span> <span class="n">found</span> <span class="p">){</span>
       <span class="o">*</span><span class="n">fileSize</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
       <span class="k">return</span> <span class="n">tar</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="n">BLOCK_SIZE</span><span class="p">;</span> <span class="cm">/* skip header, point to data */</span>
   <span class="p">}</span> <span class="k">else</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* No file found in TAR - return NULL */</span>
<span class="p">}</span>
</code></pre></div></div><h3 id="conclusion">Conclusion</h3><p>Tar does not compress data but stores it in a clear text. This is what allows not to allocate new memory but simply to return a pointer to an existing one.<p>The size of the tar block is 512 bytes. In addition, each file must be saved with a tar header. So a several bytes file will occupy 1 kilobyte in the tar file. Tar is a bad choice if you need to store many small files and do not compress the file.<p>  <container> <row><columns small="12" large="6"> <a href="https://habrahabr.ru/post/320834/" class="t30 button radius ">This article in Russian ›</a> </columns><columns small="12" large="6"> <a href="https://github.com/DeXP/dxTarRead" class="t30 button radius success">dxTarRead on GitHub ›</a> </columns> </row> </container><h2 class="t60" id="other-articles">Other Articles</h2><ul class="side-nav"><li><a href="http://localhost:4000/articles/civetwebview/">GUI &middot; <strong>Tiny desktop GUI application in PHP - 2 MB is enough</strong></a><li><a href="http://localhost:4000/articles/best-nintendo-switch-games/">Gaming &middot; <strong>Best Nintendo Switch games</strong></a><li><a href="http://localhost:4000/articles/nuklear-cross/">GUI &middot; <strong>Nuklear+ — tiny crossplatform GUI</strong></a><li><a href="http://localhost:4000/articles/advanced-jekyll/">Static site creation &middot; <strong>Advanced Jekyll</strong></a><li><a href="http://localhost:4000/articles/read-tar-in-26-lines/">Low level programming &middot; <strong>Read TAR-file in 26 lines of Ansi-C code</strong></a></ul></div><div id="page-meta" class="t30"><p> <time class="icon-calendar pr20" datetime="2017-02-11T00:00:00-07:00" itemprop="datePublished"> 2017-02-11</time> <span class="icon-archive pr20"> ARTICLES</span> <br /> <span class="pr20"><span class="icon-price-tag pr10"> articles</span> <span class="icon-price-tag pr10"> linux</span> <span class="icon-price-tag pr10"> archivers</span> <span class="icon-price-tag pr10"> tar</span> <span class="icon-price-tag pr10"> c</span> <span class="icon-price-tag pr10"> low level</span> <span class="icon-price-tag pr10"> tiny</span> </span><div id="post-nav" class="row"><div class="small-5 columns"><a class="button small radius prev" href="http://localhost:4000/articles/nuklear-intro/">&laquo; Nuklear — ideal GUI for tiny projects?</a></div><div class="small-2 columns text-center"><a class="radius button small" href="http://localhost:4000/blog/archive/" title="Blog Archive">Archive</a></div><div class="small-5 columns text-right"><a class="button small radius next" href="http://localhost:4000/tools/dxtarread/">dxTarRead &raquo;</a></div></div></div><section class="comments"><div class="constrain--body"><h2 class="comments__heading heading-2">Leave a comment</h2><form id="post-new-comment" class="form" action="https://api.staticman.net/v2/entry/DeXP/dexp.github.io/master/comments" method="post"> <input type="hidden" name="options[slug]" value="articles-read-tar-in-26-lines"> <input type="hidden" name="options[parent]" value="articles-read-tar-in-26-lines"> <input type="hidden" name="options[origin]" value="http://localhost:4000/articles/read-tar-in-26-lines/"> <input type="hidden" name="options[redirect]" value="http://localhost:4000/articles/read-tar-in-26-lines/"> <input type="text" name="company" class="text-field" style="display: none"> <input class="form__field text-field" type="text" name="fields[name]" placeholder="Name" required/> <input class="form__field text-field" type="email" name="fields[email]" placeholder="Email address (will not be public; for avatar only)" required/> <input class="form__field text-field" type="url" name="fields[url]" placeholder="Website (optional)"/> <input class="form__field text-field" type="address" name="fields[address]" placeholder="Address (do not fill!)" style="display: none"/> <textarea class="form__field text-field" rows="10" name="fields[message]" placeholder="Comment. Markdown is accepted." required></textarea> <input class="large radius button" type="submit" value="Send" /> (after comment you will be redirected back here) </form></div></section></article></div></div><div id="up-to-top" class="row"><div class="small-12 columns" style="text-align: right;"> <a class="fontel-16 icon-chevron_up" href="#top-of-page"></a></div></div><footer id="footer-content" class="bg-grau"><div id="footer"><div class="row"><div class="medium-6 large-5 columns"><h5 class="shadow-black">About This Site</h5><p class="shadow-black"> This is the home of the Arizona Jugger League, LLC. We strive to create fun, competitive Jugger tournaments! <a href="http://localhost:4000/about/">More ›</a></div><div class="small-6 medium-3 large-3 large-offset-1 columns"><h5 class="shadow-black">Services</h5><ul class="no-bullet shadow-black"><li > <a href="http://localhost:4000" title=""></a><li > <a href="http://localhost:4000/feed.xml" title="Subscribe to RSS Feed">RSS</a><li > <a href="http://localhost:4000/atom.xml" title="Subscribe to Atom Feed">Atom</a><li > <a href="http://localhost:4000/sitemap.xml" title="Sitemap for Google Webmaster Tools">sitemap.xml</a></ul></div><div class="small-6 medium-3 large-3 columns"><h5 class="shadow-black">Useful links</h5><ul class="no-bullet shadow-black"><li > <a href="http://localhost:4000" title=""></a><li class="rss-link" > <a href="http://phlow.de/" target="_blank" title="Theme author">Phlow</a><li class="sitemap-link" > <a href="http://phlow.github.io/feeling-responsive/" target="_blank" title="Theme link">Feeling Responsive</a><li class="services-newsletter" > <a href="http://foundation.zurb.com/" target="_blank" title="Built on Foundation">Built on Foundation</a></ul></div></div></div><div id="subfooter"><nav class="row"><section id="subfooter-left" class="small-12 medium-6 columns credits"><p>© Arizona Jugger League, LLC (2025)</section><section id="subfooter-right" class="small-12 medium-6 columns"><ul class="inline-list social-icons"><li><a href="http://github.com/dexp" target="_blank" class="icon-github_alt" title="GitHub"></a><li><a href="https://www.linkedin.com/in/dexperix/" target="_blank" class="icon-linkedin" title="LinkedIn"></a><li><a href="http://steamcommunity.com/id/dexp" target="_blank" class="icon-steam" title="Steam"></a><li><a href="https://vk.com/dexperix" target="_blank" class="icon-vk" title="VKontakte"></a><li><a href="https://www.facebook.com/dexperix" target="_blank" class="icon-facebook" title="Facebook"></a><li><a href="skype:dexperix?chat" target="_blank" class="icon-skype" title="Skype"></a><li><a href="https://t.me/DeXPeriX" target="_blank" class="icon-telegram" title="Telegram"></a></ul></section></nav></div></footer><script src="http://localhost:4000/assets/js/javascript.min.js"></script> <script> $("#masthead").backstretch("/images/head/matrix.png", {fade: 700}); $("#masthead-with-text").backstretch("/images/head/matrix.png", {fade: 700}); </script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-103240598-1', 'auto'); ga('set', 'anonymizeIp', true); ga('send', 'pageview'); </script>
